<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>运算符重载 | Hewie博客</title>
    <meta name="description" content="计算机校招面试、C++、算法、数据结构、操作系统、计算机网络、数据库、设计模式、Linux">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.f7236f4b.css" as="style"><link rel="preload" href="/assets/js/app.ac521fa5.js" as="script"><link rel="preload" href="/assets/js/2.4dd89565.js" as="script"><link rel="preload" href="/assets/js/33.92368679.js" as="script"><link rel="preload" href="/assets/js/3.ee0ff96a.js" as="script"><link rel="prefetch" href="/assets/js/10.943e1298.js"><link rel="prefetch" href="/assets/js/11.844d23a5.js"><link rel="prefetch" href="/assets/js/12.ed43e128.js"><link rel="prefetch" href="/assets/js/13.2444cf3e.js"><link rel="prefetch" href="/assets/js/14.2ad2a3cc.js"><link rel="prefetch" href="/assets/js/15.47795ddd.js"><link rel="prefetch" href="/assets/js/16.9769fc6d.js"><link rel="prefetch" href="/assets/js/17.b20c0604.js"><link rel="prefetch" href="/assets/js/18.9a413d64.js"><link rel="prefetch" href="/assets/js/19.39c7f303.js"><link rel="prefetch" href="/assets/js/20.215c65d9.js"><link rel="prefetch" href="/assets/js/21.675270de.js"><link rel="prefetch" href="/assets/js/22.93a75383.js"><link rel="prefetch" href="/assets/js/23.40c80597.js"><link rel="prefetch" href="/assets/js/24.a19ae02c.js"><link rel="prefetch" href="/assets/js/25.b9413425.js"><link rel="prefetch" href="/assets/js/26.ec3f30ac.js"><link rel="prefetch" href="/assets/js/27.07f945a2.js"><link rel="prefetch" href="/assets/js/28.331d1cfb.js"><link rel="prefetch" href="/assets/js/29.c78f963f.js"><link rel="prefetch" href="/assets/js/30.8f923be4.js"><link rel="prefetch" href="/assets/js/31.ea9eee00.js"><link rel="prefetch" href="/assets/js/32.4b55062e.js"><link rel="prefetch" href="/assets/js/34.31b589e5.js"><link rel="prefetch" href="/assets/js/35.5236bd4e.js"><link rel="prefetch" href="/assets/js/36.6e857b09.js"><link rel="prefetch" href="/assets/js/37.409e4231.js"><link rel="prefetch" href="/assets/js/38.779595e7.js"><link rel="prefetch" href="/assets/js/39.bbf5a6fb.js"><link rel="prefetch" href="/assets/js/4.4885d378.js"><link rel="prefetch" href="/assets/js/40.cc8c2002.js"><link rel="prefetch" href="/assets/js/41.574827e9.js"><link rel="prefetch" href="/assets/js/42.1c53ccab.js"><link rel="prefetch" href="/assets/js/43.0a1443d7.js"><link rel="prefetch" href="/assets/js/44.6b48c6eb.js"><link rel="prefetch" href="/assets/js/45.912e4128.js"><link rel="prefetch" href="/assets/js/46.07d596b0.js"><link rel="prefetch" href="/assets/js/47.aa5ef569.js"><link rel="prefetch" href="/assets/js/48.653219ec.js"><link rel="prefetch" href="/assets/js/49.ca08fe38.js"><link rel="prefetch" href="/assets/js/5.72227f9f.js"><link rel="prefetch" href="/assets/js/50.abf9c43a.js"><link rel="prefetch" href="/assets/js/51.09f33e00.js"><link rel="prefetch" href="/assets/js/52.1fca5667.js"><link rel="prefetch" href="/assets/js/53.e738e971.js"><link rel="prefetch" href="/assets/js/54.18bf1354.js"><link rel="prefetch" href="/assets/js/55.b24cd945.js"><link rel="prefetch" href="/assets/js/56.dfaf0011.js"><link rel="prefetch" href="/assets/js/57.82e8a5f7.js"><link rel="prefetch" href="/assets/js/58.76b4a75b.js"><link rel="prefetch" href="/assets/js/59.06d7e59b.js"><link rel="prefetch" href="/assets/js/6.1a982d01.js"><link rel="prefetch" href="/assets/js/60.77b63e2d.js"><link rel="prefetch" href="/assets/js/61.d297fda7.js"><link rel="prefetch" href="/assets/js/62.d91c0054.js"><link rel="prefetch" href="/assets/js/63.1a8fc45f.js"><link rel="prefetch" href="/assets/js/64.f035daaa.js"><link rel="prefetch" href="/assets/js/65.3e8dafcb.js"><link rel="prefetch" href="/assets/js/66.3cb5565a.js"><link rel="prefetch" href="/assets/js/67.3d11cc1a.js"><link rel="prefetch" href="/assets/js/68.5ee4d993.js"><link rel="prefetch" href="/assets/js/69.3fc74ef2.js"><link rel="prefetch" href="/assets/js/7.c4c59dac.js"><link rel="prefetch" href="/assets/js/8.4d197760.js"><link rel="prefetch" href="/assets/js/9.26768116.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7236f4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hewie博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/introduce/" class="nav-link">介绍</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/mini_program/" class="nav-link">小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cpp/" class="nav-link router-link-active">C++</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operation/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法修炼" class="dropdown-title"><span class="title">算法修炼</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法和数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/common/" class="nav-link">常用算法</a></li><li class="dropdown-subitem"><a href="/algorithm/sword_offer/" class="nav-link">剑指offer</a></li><li class="dropdown-subitem"><a href="/algorithm/leetcode/" class="nav-link">LeetCode</a></li><li class="dropdown-subitem"><a href="/algorithm/code_interview/" class="nav-link">程序员代码面试指南</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/design_pattem/" class="nav-link">设计模式</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/graduation/" class="nav-link">毕设</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随手记" class="dropdown-title"><span class="title">随手记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/share/" class="nav-link">每周分享</a></li><li class="dropdown-item"><!----> <a href="/more/bookmark/" class="nav-link">书签</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/Hewie8023/HewieBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/introduce/" class="nav-link">介绍</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/mini_program/" class="nav-link">小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cpp/" class="nav-link router-link-active">C++</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operation/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法修炼" class="dropdown-title"><span class="title">算法修炼</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法和数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/common/" class="nav-link">常用算法</a></li><li class="dropdown-subitem"><a href="/algorithm/sword_offer/" class="nav-link">剑指offer</a></li><li class="dropdown-subitem"><a href="/algorithm/leetcode/" class="nav-link">LeetCode</a></li><li class="dropdown-subitem"><a href="/algorithm/code_interview/" class="nav-link">程序员代码面试指南</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/design_pattem/" class="nav-link">设计模式</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/graduation/" class="nav-link">毕设</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随手记" class="dropdown-title"><span class="title">随手记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/share/" class="nav-link">每周分享</a></li><li class="dropdown-item"><!----> <a href="/more/bookmark/" class="nav-link">书签</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/Hewie8023/HewieBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C++</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cpp/" class="sidebar-link">README</a></li><li><a href="/cpp/cpp1.html" class="sidebar-link">C++基础</a></li><li><a href="/cpp/cpp2.html" class="sidebar-link">C++面向对象</a></li><li><a href="/cpp/cpp3.html" class="active sidebar-link">运算符重载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#运算符重载" class="sidebar-link">运算符重载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#运算符重载规则" class="sidebar-link">运算符重载规则</a></li><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#到底以成员函数还是全局函数（友元函数）的形式重载运算符" class="sidebar-link">到底以成员函数还是全局函数（友元函数）的形式重载运算符</a></li><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#重载-（下标运算符）" class="sidebar-link">重载[]（下标运算符）</a></li><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#赋值运算符重载" class="sidebar-link">赋值运算符重载</a></li><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#取地址及const取地址操作符重载" class="sidebar-link">取地址及const取地址操作符重载</a></li><li class="sidebar-sub-header"><a href="/cpp/cpp3.html#operator-char-什么意思" class="sidebar-link">Operator char()什么意思</a></li></ul></li></ul></li><li><a href="/cpp/cpp4.html" class="sidebar-link">C++11新特性</a></li><li><a href="/cpp/cpp5.html" class="sidebar-link">C++11多线程</a></li><li><a href="/cpp/cpp6.html" class="sidebar-link">浅析STL</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#运算符重载">运算符重载</a><ul><li><a href="#运算符重载规则">运算符重载规则</a></li><li><a href="#到底以成员函数还是全局函数（友元函数）的形式重载运算符">到底以成员函数还是全局函数（友元函数）的形式重载运算符</a></li><li><a href="#重载-（下标运算符）">重载[]（下标运算符）</a></li><li><a href="#赋值运算符重载">赋值运算符重载</a></li><li><a href="#取地址及const取地址操作符重载">取地址及const取地址操作符重载</a></li><li><a href="#operator-char-什么意思">Operator char()什么意思</a></li></ul></li></ul></div><p></p> <h2 id="运算符重载"><a href="#运算符重载" aria-hidden="true" class="header-anchor">#</a> 运算符重载</h2> <p>重载的运算符是带有特殊名称的函数，函数名是由关键字 <code>operator</code> 和其后要重载的运算符符号构成的。与其他函数一样，重载运算符有一个返回类型和一个参数列表。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>Box <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Box<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>声明加法运算符用于把两个 <code>Box</code> 对象相加，返回最终的 <code>Box</code> 对象。大多数的重载运算符可被定义为普通的非成员函数或者被定义为类成员函数。如果我们定义上面的函数为类的非成员函数，那么我们需要为每次操作传递两个参数，如下所示：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>Box <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Box<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> Box<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>例子：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">complex</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">complex</span><span class="token punctuation">(</span><span class="token keyword">double</span> real<span class="token punctuation">,</span> <span class="token keyword">double</span> imag<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//声明运算符重载</span>
    complex <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> complex <span class="token operator">&amp;</span>A<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">double</span> m_real<span class="token punctuation">;</span>  <span class="token comment">//实部</span>
    <span class="token keyword">double</span> m_imag<span class="token punctuation">;</span>  <span class="token comment">//虚部</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
complex<span class="token operator">::</span><span class="token function">complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_real</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_imag</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
complex<span class="token operator">::</span><span class="token function">complex</span><span class="token punctuation">(</span><span class="token keyword">double</span> real<span class="token punctuation">,</span> <span class="token keyword">double</span> imag<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_real</span><span class="token punctuation">(</span>real<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_imag</span><span class="token punctuation">(</span>imag<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token comment">//实现运算符重载</span>
complex complex<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> complex <span class="token operator">&amp;</span>A<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    complex B<span class="token punctuation">;</span>
    B<span class="token punctuation">.</span>m_real <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>m_real <span class="token operator">+</span> A<span class="token punctuation">.</span>m_real<span class="token punctuation">;</span>
    B<span class="token punctuation">.</span>m_imag <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>m_imag <span class="token operator">+</span> A<span class="token punctuation">.</span>m_imag<span class="token punctuation">;</span>
    <span class="token keyword">return</span> B<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> complex<span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    cout<span class="token operator">&lt;&lt;</span>m_real<span class="token operator">&lt;&lt;</span><span class="token string">&quot; + &quot;</span><span class="token operator">&lt;&lt;</span>m_imag<span class="token operator">&lt;&lt;</span><span class="token string">&quot;i&quot;</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">5.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">2.4</span><span class="token punctuation">,</span> <span class="token number">3.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    complex c3<span class="token punctuation">;</span>
    c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
    c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们在 <code>complex</code> 类中重载了运算符+，该重载只对 <code>complex</code> 对象有效。当执行<code>c3 = c1 + c2</code>;语句时，编译器检测到<code>+</code>号左边（<code>+</code>号具有左结合性，所以先检测左边）是一个 <code>complex</code> 对象，就会调用成员函数<code>operator+()</code>，也就是转换为下面的形式：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>c3 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>c1</code> 是要调用函数的对象，<code>c2</code> 是函数的实参。</p> <p><strong>运算符重载函数不仅可以作为类的成员函数</strong>，还可以作为全局函数。更改上面的代码，在全局范围内重载<code>+</code>，实现复数的加法运算：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">complex</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">complex</span><span class="token punctuation">(</span><span class="token keyword">double</span> real<span class="token punctuation">,</span> <span class="token keyword">double</span> imag<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token comment">//声明为友元函数</span>
    <span class="token keyword">friend</span> complex <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> complex <span class="token operator">&amp;</span>A<span class="token punctuation">,</span> <span class="token keyword">const</span> complex <span class="token operator">&amp;</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">double</span> m_real<span class="token punctuation">;</span>
    <span class="token keyword">double</span> m_imag<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
complex <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> complex <span class="token operator">&amp;</span>A<span class="token punctuation">,</span> <span class="token keyword">const</span> complex <span class="token operator">&amp;</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
complex<span class="token operator">::</span><span class="token function">complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_real</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_imag</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
complex<span class="token operator">::</span><span class="token function">complex</span><span class="token punctuation">(</span><span class="token keyword">double</span> real<span class="token punctuation">,</span> <span class="token keyword">double</span> imag<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_real</span><span class="token punctuation">(</span>real<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_imag</span><span class="token punctuation">(</span>imag<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> complex<span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    cout<span class="token operator">&lt;&lt;</span>m_real<span class="token operator">&lt;&lt;</span><span class="token string">&quot; + &quot;</span><span class="token operator">&lt;&lt;</span>m_imag<span class="token operator">&lt;&lt;</span><span class="token string">&quot;i&quot;</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//在全局范围内重载+</span>
complex <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> complex <span class="token operator">&amp;</span>A<span class="token punctuation">,</span> <span class="token keyword">const</span> complex <span class="token operator">&amp;</span>B<span class="token punctuation">)</span><span class="token punctuation">{</span>
    complex C<span class="token punctuation">;</span>
    C<span class="token punctuation">.</span>m_real <span class="token operator">=</span> A<span class="token punctuation">.</span>m_real <span class="token operator">+</span> B<span class="token punctuation">.</span>m_real<span class="token punctuation">;</span>
    C<span class="token punctuation">.</span>m_imag <span class="token operator">=</span> A<span class="token punctuation">.</span>m_imag <span class="token operator">+</span> B<span class="token punctuation">.</span>m_imag<span class="token punctuation">;</span>
    <span class="token keyword">return</span> C<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">5.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">2.4</span><span class="token punctuation">,</span> <span class="token number">3.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    complex c3<span class="token punctuation">;</span>
    c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
    c3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运算符重载函数不是 <code>complex</code> 类的成员函数，但是却用到了 <code>complex</code> 类的 <code>private</code> 成员变量，所以必须在 <code>complex</code> 类中将该函数声明为友元函数。</p> <p>当执行<code>c3 = c1 + c2</code>;语句时，编译器检测到<code>+</code>号两边都是 <code>complex</code> 对象，就会转换为类似下面的函数调用：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>c3 <span class="token operator">=</span> <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="运算符重载规则"><a href="#运算符重载规则" aria-hidden="true" class="header-anchor">#</a> 运算符重载规则</h3> <ol><li>不是所有的运算符都可以重载。长度运算符<code>sizeof</code>、条件运算符: <code>?</code>、成员选择符<code>.</code>和域解析运算符<code>::</code>不能被重载。</li> <li>重载不能改变运算符的优先级和结合性。</li> <li>重载不会改变运算符的用法。</li> <li>运算符重载函数不能有默认的参数，否则就改变了运算符操作数的个数。</li> <li>运算符函数既可以作为类的成员函数，也可以作为全局函数。</li> <li>箭头运算符<code>-&gt;</code>、下标运算符<code>[ ]</code>、函数调用运算符<code>( )</code>、赋值运算符<code>=</code>只能以成员函数的形式重载。</li></ol> <h3 id="到底以成员函数还是全局函数（友元函数）的形式重载运算符"><a href="#到底以成员函数还是全局函数（友元函数）的形式重载运算符" aria-hidden="true" class="header-anchor">#</a> 到底以成员函数还是全局函数（友元函数）的形式重载运算符</h3> <ul><li><p>一般而言，对于双目运算符，最好将其重载为友元函数；而对于单目运算符，则最好重载为成员函数。
但是也存在例外情况。有些双目运算符是不能重载为友元函数的，比如赋值运算符<code>=</code>、函数调用运算符<code>()</code>、下标运算符<code>[]</code>、指针运算符<code>-&gt;</code>等，因为这些运算符在语义上与<code>this</code>都有太多的关联。比如<code>=</code>表示“将自身赋值为…”，<code>[]</code>表示“自己的第几个元素”，如果将其重载为友元函数，则会出现语义上的不一致。</p></li> <li><p>还有一个需要特别说明的就是输出运算符<code>&lt;&lt;</code>。因为<code>&lt;&lt;</code>的第一个操作数一定是<code>ostream</code>类型，所以<code>&lt;&lt;</code>只能重载为友元函数，如下：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">friend</span> ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span> <span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span> <span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> c<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    os <span class="token operator">&lt;&lt;</span> c<span class="token punctuation">.</span>m_Real <span class="token operator">&lt;&lt;</span> “<span class="token operator">+</span>” <span class="token operator">&lt;&lt;</span> c<span class="token punctuation">.</span>m_Imag <span class="token operator">&lt;&lt;</span> “i” <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>所以，对于 <code>=</code>、<code>[]</code>、<code>()</code>、<code>-&gt;</code>以及所有的类型转换运算符只能作为非静态成员函数重载。如果允许第一操作数不是同类对象，而是其他数据类型，则只能作为非成员函数重载（如输入输出流运算符<code>&gt;&gt;</code>和<code>&lt;&lt;</code>就是这样的情况）。</p></li></ul> <h3 id="重载-（下标运算符）"><a href="#重载-（下标运算符）" aria-hidden="true" class="header-anchor">#</a> 重载[]（下标运算符）</h3> <p>下标运算符[ ]必须以成员函数的形式进行重载。该重载函数在类中的声明格式如下：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>返回值类型 <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span> <span class="token punctuation">]</span> <span class="token punctuation">(</span>参数<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">const</span> 返回值类型 <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span> <span class="token punctuation">]</span> <span class="token punctuation">(</span>参数<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre></div><p>使用第一种声明方式，<code>[]</code>不仅可以访问元素，还可以修改元素。使用第二种声明方式，<code>[]</code>只能访问而不能修改元素。在实际开发中，我们应该同时提供以上两种形式，这样做是为了适应 <code>const</code> 对象，因为通过 <code>const</code> 对象只能调用 <code>const</code> 成员函数，如果不提供第二种形式，那么将无法访问 <code>const</code> 对象的任何元素。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Array</span><span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Array</span><span class="token punctuation">(</span><span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> m_length<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_length<span class="token punctuation">;</span>  <span class="token comment">//数组长度</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>m_p<span class="token punctuation">;</span>  <span class="token comment">//指向数组内存的指针</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Array<span class="token operator">::</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">m_length</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        m_p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        m_p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Array<span class="token operator">::</span><span class="token operator">~</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> m_p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span><span class="token operator">&amp;</span> Array<span class="token operator">::</span><span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> m_p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span> Array<span class="token operator">::</span><span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> m_p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> Array<span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m_length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> m_length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            cout<span class="token operator">&lt;&lt;</span>m_p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            cout<span class="token operator">&lt;&lt;</span>m_p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> n<span class="token punctuation">;</span>
    cin<span class="token operator">&gt;&gt;</span>n<span class="token punctuation">;</span>
    Array <span class="token function">A</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> A<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    A<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">const</span> Array <span class="token function">B</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout<span class="token operator">&lt;&lt;</span>B<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>  <span class="token comment">//访问最后一个元素</span>
   
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重载<code>[]</code>运算符以后，表达式<code>arr[i]</code>会被转换为：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>arr<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>需要说明的是，<code>B</code> 是 <code>const</code> 对象，如果 <code>Array</code> 类没有提供 <code>const</code> 版本的<code>operator[]</code>，那么倒数第二行代码将报错。虽然这行代码只是读取对象的数据，并没有试图修改对象，但是它调用了非 <code>const</code> 版本的<code>operator[]</code>，编译器不管实际上有没有修改对象，只要是调用了非 <code>const</code> 的成员函数，编译器就认为会修改对象（至少有这种风险）。</p> <h3 id="赋值运算符重载"><a href="#赋值运算符重载" aria-hidden="true" class="header-anchor">#</a> 赋值运算符重载</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyStr</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">MyStr</span><span class="token punctuation">(</span><span class="token keyword">int</span> _id<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>_name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;constructor&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        id <span class="token operator">=</span> _id<span class="token punctuation">;</span>
        name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">strcpy_s</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>_name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token function">MyStr</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyStr <span class="token operator">&amp;</span>str<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;copy constructor&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        id <span class="token operator">=</span> str<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">delete</span> name<span class="token punctuation">;</span>
        name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">strcpy_s</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>str<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    MyStr<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyStr<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;operator=&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token keyword">delete</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-&gt;</span>id <span class="token operator">=</span> str<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
            name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">strcpy_s</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>str<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">MyStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;deconstructor&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    MyStr <span class="token function">str1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MyStr str2<span class="token punctuation">;</span>
    str2 <span class="token operator">=</span> str1<span class="token punctuation">;</span>
    MyStr str3 <span class="token operator">=</span> str2<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果将上述例子显示提供的拷贝函数注释掉，然后同样执行<code>MyStr str3 = str2</code>;语句，此时调用默认的拷贝构造函数，它们指向内存中的同一区域。
这样会有两个致命错误：</p> <ol><li><code>str2</code>修改<code>name</code>时，<code>str3</code>的<code>name</code>也会被修改；</li> <li>当执行<code>str2</code>和<code>str3</code>的析构函数时，会导致同一内存区域释放两次，程序崩溃。</li></ol> <p>所以，必须通过显示提供拷贝构造函数以避免这样的问题，如上述例子，先判断被拷贝者的<code>name</code>是否为空，若否，<code>delete name</code>，然后为<code>name</code>重新申请空间，再将拷贝者<code>name</code>中的数据拷贝到被拷贝者的<code>name</code>中，这样，<code>str2.name</code>和<code>str3.name</code>各自独立，避免了上面两个错误。赋值运算符重载函数也是同样的道理。</p> <p><strong>赋值运算符重载函数只能是类的非静态的成员函数</strong></p> <ol><li>因为静态成员函数只能操作类的静态成员，无法操作类的非静态成员，可以参考静态成员变量和静态成员函数在<code>C++</code>类中的作用来进行理解；</li> <li>避免二义性</li></ol> <p>当程序没有显示提供一个以本类或者本类的引用为参数的赋值运算符重载函数时，编译器会自动提供一个。现在假设<code>C++</code>允许友元函数定义的赋值运算符重载函数，而且以引用为参数，与此同时，编译器也提供一个默认的赋值运算符重载函数（由于友元函数不属于这个类，所以此时编译器会自动提供一个）。但是当再执行类似<code>str2 = str1</code>;这样的代码时，编译器就困惑了。</p> <p>为了避免这样的二义性，<code>C++</code>强制规定，赋值运算符重载函数只能定义为类的成员函数，这样编译器就能判断是否需要提供默认版本了。</p> <h3 id="取地址及const取地址操作符重载"><a href="#取地址及const取地址操作符重载" aria-hidden="true" class="header-anchor">#</a> 取地址及const取地址操作符重载</h3> <p>取地址是什么意思呢？就是返回当前对象的地址，对于成员函数来讲，<code>this</code>指针就是它的地址，需要返回指针。</p> <p><code>&amp;</code>运算符是一个单目运算符，其只有一个参数，而这个参数就是一个对象，所以说这个对象是不用传的，定义为成员函数时函数参数就应该少一个，第一个函数参数就被<code>this</code>指针所代替。所以，在此不需要进行传参。</p> <p><code>const</code>成员函数及<code>const</code>对象去调用，普通的成员函数普通的对象来进行调用，若没有普通成员函数，那么普通对象也能够调用<code>const</code>成员函数。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Date</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">const</span> Date<span class="token operator">&amp;</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		_year <span class="token operator">=</span> d<span class="token punctuation">.</span>_year<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	Date<span class="token operator">*</span> <span class="token keyword">operator</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Date* operator&amp;()&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">const</span> Date<span class="token operator">*</span> <span class="token keyword">operator</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;const Date* operator&amp;() const&quot;</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Date <span class="token function">d1</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> Date <span class="token function">d2</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
	Date<span class="token operator">*</span> pa1 <span class="token operator">=</span> <span class="token operator">&amp;</span>d1<span class="token punctuation">;</span>
	<span class="token keyword">const</span> Date<span class="token operator">*</span> pd2 <span class="token operator">=</span> <span class="token operator">&amp;</span>d2<span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果不写这两个函数的时候，编译器会帮助默认生成，若无其它操作完全够用了，因为这两个函数只返回<code>this</code>指针，也没有其他的操作。除非，你想返回别的地址，可以做到''返回你想返回的地址''，比如，返回一个病毒的地址，返回一个很深的调用链等等，可以自己按照需求进行重载实现，否则不必实现也无影响。</p> <h3 id="operator-char-什么意思"><a href="#operator-char-什么意思" aria-hidden="true" class="header-anchor">#</a> Operator char()什么意思</h3> <p>operator用于类型转换函数</p> <p>类型转换函数的特征：</p> <ol><li>型转换函数定义在源类中；</li> <li>须由 <code>operator</code> 修饰，函数名称是目标类型名或目标类名；</li> <li>函数没有参数，没有返回值，但是有 <code>return</code> 语句，在<code>return</code>语句中返回目标类型数据或调用目标类的构造函数。
类型转换函数主要有两类：</li></ol> <p><strong>1） 对象向基本数据类型转换：</strong></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>
<span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>
     <span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">d_</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 
     <span class="token comment">/* “(int)D”类型转换:将类型D转换成int */</span>
     <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
         std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;(int)d called!&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>d_<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
  <span class="token keyword">private</span><span class="token operator">:</span>
     <span class="token keyword">double</span> d_<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
  <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     D d1 <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
     D d2 <span class="token operator">=</span> <span class="token number">2.2</span><span class="token punctuation">;</span>
     std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">add</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>执行add(d1,d2)函数时“(int)D”类型转换函数将被自动调用，程序运行的输出为：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>d called<span class="token operator">!</span>
<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>d called<span class="token operator">!</span>
<span class="token number">3</span>
</code></pre></div><p><strong>2）对象向不同类的对象的转换：</strong></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>
     <span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">dat</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
     
     <span class="token comment">/* &quot;(int)a&quot;类型转换 */</span>
     <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> dat<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 
  <span class="token keyword">private</span><span class="token operator">:</span>
     <span class="token keyword">int</span> dat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 
<span class="token keyword">class</span> <span class="token class-name">X</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>
     <span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">dat</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 
     <span class="token comment">/* &quot;(int)a&quot;类型转换 */</span>
     <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> dat<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 
     <span class="token comment">/* &quot;(A)a&quot;类型转换 */</span>
     <span class="token keyword">operator</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         A temp <span class="token operator">=</span> dat<span class="token punctuation">;</span>
         <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
  <span class="token keyword">private</span><span class="token operator">:</span>
     <span class="token keyword">int</span> dat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     X stuff <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span>
     A more <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
     <span class="token keyword">int</span> hold<span class="token punctuation">;</span>
 
     hold <span class="token operator">=</span> stuff<span class="token punctuation">;</span>    <span class="token comment">// convert X::stuff to int</span>
     std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> hold <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
 
     more <span class="token operator">=</span> stuff<span class="token punctuation">;</span>    <span class="token comment">// convert X::stuff to A::more</span>
     std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> more <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>        <span class="token comment">// convert A::more to int</span>
 
     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面这个程序中<code>X</code>类通过<code>operator A()</code>类型转换来实现将<code>X</code>类型对象转换成<code>A</code>类型，这种方式需要先创建一个临时<code>A</code>对象再用它去赋值目标对象；更好的方式是为<code>A</code>类增加一个构造函数：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">A</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">dat</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Hewie8023/HewieBlog/edit/master/docs/cpp/cpp3.md" target="_blank" rel="noopener noreferrer">编辑文档~</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019-10-25 16:20:08</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cpp/cpp2.html" class="prev">C++面向对象</a></span> <span class="next"><a href="/cpp/cpp4.html">C++11新特性</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div></div></div></div>
    <script src="/assets/js/app.ac521fa5.js" defer></script><script src="/assets/js/2.4dd89565.js" defer></script><script src="/assets/js/33.92368679.js" defer></script><script src="/assets/js/3.ee0ff96a.js" defer></script>
  </body>
</html>
