<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常用SQL | Hewie博客</title>
    <meta name="description" content="计算机校招面试、C++、算法、数据结构、操作系统、计算机网络、数据库、设计模式、Linux">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.f7236f4b.css" as="style"><link rel="preload" href="/assets/js/app.ac521fa5.js" as="script"><link rel="preload" href="/assets/js/2.4dd89565.js" as="script"><link rel="preload" href="/assets/js/41.574827e9.js" as="script"><link rel="preload" href="/assets/js/3.ee0ff96a.js" as="script"><link rel="prefetch" href="/assets/js/10.943e1298.js"><link rel="prefetch" href="/assets/js/11.844d23a5.js"><link rel="prefetch" href="/assets/js/12.ed43e128.js"><link rel="prefetch" href="/assets/js/13.2444cf3e.js"><link rel="prefetch" href="/assets/js/14.2ad2a3cc.js"><link rel="prefetch" href="/assets/js/15.47795ddd.js"><link rel="prefetch" href="/assets/js/16.9769fc6d.js"><link rel="prefetch" href="/assets/js/17.b20c0604.js"><link rel="prefetch" href="/assets/js/18.9a413d64.js"><link rel="prefetch" href="/assets/js/19.39c7f303.js"><link rel="prefetch" href="/assets/js/20.215c65d9.js"><link rel="prefetch" href="/assets/js/21.675270de.js"><link rel="prefetch" href="/assets/js/22.93a75383.js"><link rel="prefetch" href="/assets/js/23.40c80597.js"><link rel="prefetch" href="/assets/js/24.a19ae02c.js"><link rel="prefetch" href="/assets/js/25.b9413425.js"><link rel="prefetch" href="/assets/js/26.ec3f30ac.js"><link rel="prefetch" href="/assets/js/27.07f945a2.js"><link rel="prefetch" href="/assets/js/28.331d1cfb.js"><link rel="prefetch" href="/assets/js/29.c78f963f.js"><link rel="prefetch" href="/assets/js/30.8f923be4.js"><link rel="prefetch" href="/assets/js/31.ea9eee00.js"><link rel="prefetch" href="/assets/js/32.4b55062e.js"><link rel="prefetch" href="/assets/js/33.92368679.js"><link rel="prefetch" href="/assets/js/34.31b589e5.js"><link rel="prefetch" href="/assets/js/35.5236bd4e.js"><link rel="prefetch" href="/assets/js/36.6e857b09.js"><link rel="prefetch" href="/assets/js/37.409e4231.js"><link rel="prefetch" href="/assets/js/38.779595e7.js"><link rel="prefetch" href="/assets/js/39.bbf5a6fb.js"><link rel="prefetch" href="/assets/js/4.4885d378.js"><link rel="prefetch" href="/assets/js/40.cc8c2002.js"><link rel="prefetch" href="/assets/js/42.1c53ccab.js"><link rel="prefetch" href="/assets/js/43.0a1443d7.js"><link rel="prefetch" href="/assets/js/44.6b48c6eb.js"><link rel="prefetch" href="/assets/js/45.912e4128.js"><link rel="prefetch" href="/assets/js/46.07d596b0.js"><link rel="prefetch" href="/assets/js/47.aa5ef569.js"><link rel="prefetch" href="/assets/js/48.653219ec.js"><link rel="prefetch" href="/assets/js/49.ca08fe38.js"><link rel="prefetch" href="/assets/js/5.72227f9f.js"><link rel="prefetch" href="/assets/js/50.abf9c43a.js"><link rel="prefetch" href="/assets/js/51.09f33e00.js"><link rel="prefetch" href="/assets/js/52.1fca5667.js"><link rel="prefetch" href="/assets/js/53.e738e971.js"><link rel="prefetch" href="/assets/js/54.18bf1354.js"><link rel="prefetch" href="/assets/js/55.b24cd945.js"><link rel="prefetch" href="/assets/js/56.dfaf0011.js"><link rel="prefetch" href="/assets/js/57.82e8a5f7.js"><link rel="prefetch" href="/assets/js/58.76b4a75b.js"><link rel="prefetch" href="/assets/js/59.06d7e59b.js"><link rel="prefetch" href="/assets/js/6.1a982d01.js"><link rel="prefetch" href="/assets/js/60.77b63e2d.js"><link rel="prefetch" href="/assets/js/61.d297fda7.js"><link rel="prefetch" href="/assets/js/62.d91c0054.js"><link rel="prefetch" href="/assets/js/63.1a8fc45f.js"><link rel="prefetch" href="/assets/js/64.f035daaa.js"><link rel="prefetch" href="/assets/js/65.3e8dafcb.js"><link rel="prefetch" href="/assets/js/66.3cb5565a.js"><link rel="prefetch" href="/assets/js/67.3d11cc1a.js"><link rel="prefetch" href="/assets/js/68.5ee4d993.js"><link rel="prefetch" href="/assets/js/69.3fc74ef2.js"><link rel="prefetch" href="/assets/js/7.c4c59dac.js"><link rel="prefetch" href="/assets/js/8.4d197760.js"><link rel="prefetch" href="/assets/js/9.26768116.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7236f4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hewie博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/introduce/" class="nav-link">介绍</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/mini_program/" class="nav-link">小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cpp/" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operation/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link router-link-active">数据库</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法修炼" class="dropdown-title"><span class="title">算法修炼</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法和数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/common/" class="nav-link">常用算法</a></li><li class="dropdown-subitem"><a href="/algorithm/sword_offer/" class="nav-link">剑指offer</a></li><li class="dropdown-subitem"><a href="/algorithm/leetcode/" class="nav-link">LeetCode</a></li><li class="dropdown-subitem"><a href="/algorithm/code_interview/" class="nav-link">程序员代码面试指南</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/design_pattem/" class="nav-link">设计模式</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/graduation/" class="nav-link">毕设</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随手记" class="dropdown-title"><span class="title">随手记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/share/" class="nav-link">每周分享</a></li><li class="dropdown-item"><!----> <a href="/more/bookmark/" class="nav-link">书签</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/Hewie8023/HewieBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/introduce/" class="nav-link">介绍</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/mini_program/" class="nav-link">小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cpp/" class="nav-link">C++</a></li><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/operation/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link router-link-active">数据库</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法修炼" class="dropdown-title"><span class="title">算法修炼</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法和数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/common/" class="nav-link">常用算法</a></li><li class="dropdown-subitem"><a href="/algorithm/sword_offer/" class="nav-link">剑指offer</a></li><li class="dropdown-subitem"><a href="/algorithm/leetcode/" class="nav-link">LeetCode</a></li><li class="dropdown-subitem"><a href="/algorithm/code_interview/" class="nav-link">程序员代码面试指南</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/design_pattem/" class="nav-link">设计模式</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/graduation/" class="nav-link">毕设</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随手记" class="dropdown-title"><span class="title">随手记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/share/" class="nav-link">每周分享</a></li><li class="dropdown-item"><!----> <a href="/more/bookmark/" class="nav-link">书签</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/Hewie8023/HewieBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" class="sidebar-link">README</a></li><li><a href="/database/db1.html" class="sidebar-link">事务</a></li><li><a href="/database/db2.html" class="sidebar-link">并发一致性问题</a></li><li><a href="/database/db3.html" class="sidebar-link">隔离级别</a></li><li><a href="/database/db4.html" class="active sidebar-link">常用SQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/db4.html#数据库创建" class="sidebar-link">数据库创建</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#创建表" class="sidebar-link">创建表</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#修改表" class="sidebar-link">修改表</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#插入" class="sidebar-link">插入</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#更新" class="sidebar-link">更新</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#删除" class="sidebar-link">删除</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#查询" class="sidebar-link">查询</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#过滤" class="sidebar-link">过滤</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#通配符" class="sidebar-link">通配符</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#计算字段" class="sidebar-link">计算字段</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#文本处理" class="sidebar-link">文本处理</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#分组" class="sidebar-link">分组</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#子查询" class="sidebar-link">子查询</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#连接" class="sidebar-link">连接</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#组合查询" class="sidebar-link">组合查询</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#视图" class="sidebar-link">视图</a></li><li class="sidebar-sub-header"><a href="/database/db4.html#存储过程" class="sidebar-link">存储过程</a></li></ul></li><li><a href="/database/db5.html" class="sidebar-link">MySQL</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#数据库创建">数据库创建</a></li><li><a href="#创建表">创建表</a></li><li><a href="#修改表">修改表</a></li><li><a href="#插入">插入</a></li><li><a href="#更新">更新</a></li><li><a href="#删除">删除</a></li><li><a href="#查询">查询</a></li><li><a href="#排序">排序</a></li><li><a href="#过滤">过滤</a></li><li><a href="#通配符">通配符</a></li><li><a href="#计算字段">计算字段</a></li><li><a href="#函数">函数</a></li><li><a href="#文本处理">文本处理</a></li><li><a href="#分组">分组</a></li><li><a href="#子查询">子查询</a></li><li><a href="#连接">连接</a></li><li><a href="#组合查询">组合查询</a></li><li><a href="#视图">视图</a></li><li><a href="#存储过程">存储过程</a></li></ul></div><p></p> <h2 id="数据库创建"><a href="#数据库创建" aria-hidden="true" class="header-anchor">#</a> 数据库创建</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> test<span class="token punctuation">;</span>
<span class="token keyword">USE</span> test<span class="token punctuation">;</span>
</code></pre></div><h2 id="创建表"><a href="#创建表" aria-hidden="true" class="header-anchor">#</a> 创建表</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable <span class="token punctuation">(</span>
  <span class="token comment"># int 类型，不为空，自增</span>
  id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token comment"># int 类型，不可为空，默认值为 1，不为空</span>
  col1 <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token comment"># 变长字符串类型，最长为 45 个字符，可以为空</span>
  col2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token comment"># 日期类型，可为空</span>
  col3 <span class="token keyword">DATE</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token comment"># 设置主键为 id</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="修改表"><a href="#修改表" aria-hidden="true" class="header-anchor">#</a> 修改表</h2> <ul><li><p>添加列</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mytable
<span class="token keyword">ADD</span> col <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>删除列</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mytable
<span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> col<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>删除表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="插入"><a href="#插入" aria-hidden="true" class="header-anchor">#</a> 插入</h2> <ul><li><p>普通插入</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mytable<span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>插入检索出来的数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mytable1<span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> col1<span class="token punctuation">,</span> col2
<span class="token keyword">FROM</span> mytable2<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>将一个表的内容插入到一个新表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> newtable <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="更新"><a href="#更新" aria-hidden="true" class="header-anchor">#</a> 更新</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> mytable
<span class="token keyword">SET</span> col <span class="token operator">=</span> val
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="删除"><a href="#删除" aria-hidden="true" class="header-anchor">#</a> 删除</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p><code>TRUNCATE TABLE</code> 可以清空表，也就是删除所有行。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">;</span>
</code></pre></div><p>使用更新和删除操作时一定要用 <code>WHERE</code> 子句，不然会把整张表的数据都破坏。可以先用 <code>SELECT</code> 语句进行测试，防止错误删除。</p> <h2 id="查询"><a href="#查询" aria-hidden="true" class="header-anchor">#</a> 查询</h2> <ul><li><p><strong>DISTINCT</strong></p> <p>相同值只会出现一次。它作用于所有列，也就是说所有列的值都相同才算相同。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> col1<span class="token punctuation">,</span> col2
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre></div></li> <li><p><strong>LIMIT</strong></p> <p>限制返回的行数。可以有两个参数，第一个参数为起始行，从 0 开始；第二个参数为返回的总行数。</p> <ul><li><p>返回前 5 行：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>返回第 3 ~ 5 行：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h2 id="排序"><a href="#排序" aria-hidden="true" class="header-anchor">#</a> 排序</h2> <ul><li>ASC ：升序（默认）</li> <li>DESC ：降序</li></ul> <p>可以按多个列进行排序，并且为每个列指定不同的排序方式：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> col1 <span class="token keyword">DESC</span><span class="token punctuation">,</span> col2 <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="过滤"><a href="#过滤" aria-hidden="true" class="header-anchor">#</a> 过滤</h2> <p>不进行过滤的数据非常大，导致通过网络传输了多余的数据，从而浪费了网络带宽。因此尽量使用 SQL 语句来过滤不必要的数据，而不是传输所有的数据到客户端中然后由客户端进行过滤。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre></div><p>下表显示了 <code>WHERE</code> 子句可用的操作符</p> <table><thead><tr><th>操作符</th> <th>说明</th></tr></thead> <tbody><tr><td>=</td> <td>等于</td></tr> <tr><td>&lt;</td> <td>小于</td></tr> <tr><td>&gt;</td> <td>大于</td></tr> <tr><td>&lt;&gt; !=</td> <td>不等于</td></tr> <tr><td>&lt;= !&gt;</td> <td>小于等于</td></tr> <tr><td>&gt;= !&lt;</td> <td>大于等于</td></tr> <tr><td>BETWEEN</td> <td>在两个值之间</td></tr> <tr><td>IS NULL</td> <td>为 NULL</td></tr></tbody></table> <p>应该注意到，<code>NULL</code> 与 <code>0</code>、空字符串都不同。</p> <p><strong>AND</strong> 和 <strong>OR</strong> 用于连接多个过滤条件。优先处理 <strong>AND</strong>，当一个过滤表达式涉及到多个 <strong>AND</strong> 和 <strong>OR</strong> 时，可以使用 <code>()</code> 来决定优先级，使得优先级关系更清晰。</p> <p><strong>IN</strong>操作符用于匹配一组值，其后也可以接一个 <code>SELECT</code> 子句，从而匹配子查询得到的一组值。</p> <p><strong>NOT</strong> 操作符用于否定一个条件。</p> <h2 id="通配符"><a href="#通配符" aria-hidden="true" class="header-anchor">#</a> 通配符</h2> <p>通配符也是用在过滤语句中，但它只能用于文本字段。</p> <ul><li><code>%</code> 匹配 <code>&gt;=0</code> 个任意字符；</li> <li><code>_</code> 匹配 <code>==1</code> 个任意字符；</li> <li><code>[]</code> 可以匹配集合内的字符，例如 <code>[ab]</code> 将匹配字符 <code>a</code> 或者 <code>b</code>。用脱字符 <code>^</code> 可以对其进行否定，也就是不匹配集合内的字符。</li></ul> <p>使用 <code>Like</code> 来进行通配符匹配。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">LIKE</span> <span class="token string">'[^AB]%'</span><span class="token punctuation">;</span> <span class="token comment">-- 不以 A 和 B 开头的任意文本</span>
</code></pre></div><h2 id="计算字段"><a href="#计算字段" aria-hidden="true" class="header-anchor">#</a> 计算字段</h2> <p>在数据库服务器上完成数据的转换和格式化的工作往往比客户端上快得多，并且转换和格式化后的数据量更少的话可以减少网络通信量。</p> <p>计算字段通常需要使用 <code>AS</code> 来取别名，否则输出的时候字段名为计算表达式。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col1 <span class="token operator">*</span> col2 <span class="token keyword">AS</span> alias
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre></div><p><code>CONCAT()</code> 用于连接两个字段。许多数据库会使用空格把一个值填充为列宽，因此连接的结果会出现一些不必要的空格，使用 <code>TRIM()</code> 可以去除首尾空格。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>TRIM<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> TRIM<span class="token punctuation">(</span>col2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> concat_col
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre></div><h2 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数</h2> <p>以下主要是 <code>MySQL</code> 的函数。</p> <table><thead><tr><th>函 数</th> <th>说明</th></tr></thead> <tbody><tr><td>AVG()</td> <td>返回某列的平均值</td></tr> <tr><td>COUNT()</td> <td>返回某列的行数</td></tr> <tr><td>MAX()</td> <td>返回某列的最大值</td></tr> <tr><td>MIN()</td> <td>返回某列的最小值</td></tr> <tr><td>SUM()</td> <td>返回某列值之和</td></tr></tbody></table> <p>AVG() 会忽略 NULL 行。</p> <p>使用 <code>DISTINCT</code> 可以汇总不同的值。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> col1<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_col
<span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>
</code></pre></div><h2 id="文本处理"><a href="#文本处理" aria-hidden="true" class="header-anchor">#</a> 文本处理</h2> <table><thead><tr><th>函数</th> <th>说明</th></tr></thead> <tbody><tr><td>LEFT ()</td> <td>左边的字符</td></tr> <tr><td>RIGHT()</td> <td>右边的字符</td></tr> <tr><td>LOWER()</td> <td>转换为小写字符</td></tr> <tr><td>UPPER()</td> <td>转换为大写字符</td></tr> <tr><td>LTRIM()</td> <td>去除左边的空格</td></tr> <tr><td>RTRIM()</td> <td>去除右边的空格</td></tr> <tr><td>LENGTH()</td> <td>长度</td></tr> <tr><td>SOUNDEX()</td> <td>转换为语音值</td></tr></tbody></table> <h2 id="分组"><a href="#分组" aria-hidden="true" class="header-anchor">#</a> 分组</h2> <p>把具有相同的数据值的行放在同一组中。</p> <p>可以对同一分组数据使用汇总函数进行处理，例如求分组数据的平均值等。</p> <p>指定的分组字段除了能按该字段进行分组，也会自动按该字段进行排序。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> mytable
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col<span class="token punctuation">;</span>
</code></pre></div><p><code>GROUP BY</code> 自动按分组字段进行排序，<code>ORDER BY</code> 也可以按汇总字段来进行排序。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> mytable
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num<span class="token punctuation">;</span>
</code></pre></div><p><code>WHERE</code> 过滤行，<code>HAVING</code> 过滤分组，行过滤应当先于分组过滤。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">&gt;</span> <span class="token number">2</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col
<span class="token keyword">HAVING</span> num <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre></div><p>分组规定：</p> <ul><li><code>GROUP BY</code> 子句出现在 <code>WHERE</code> 子句之后，<code>ORDER BY</code> 子句之前；</li> <li>除了汇总字段外，<code>SELECT</code> 语句中的每一字段都必须在 <code>GROUP BY</code> 子句中给出；</li> <li><code>NULL</code> 的行会单独分为一组；</li> <li>大多数 <code>SQL</code> 实现不支持 <code>GROUP BY</code> 列具有可变长度的数据类型。</li></ul> <h2 id="子查询"><a href="#子查询" aria-hidden="true" class="header-anchor">#</a> 子查询</h2> <p>子查询中只能返回一个字段的数据。</p> <p>可以将子查询的结果作为 <code>WHRER</code> 语句的过滤条件：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> mytable1
<span class="token keyword">WHERE</span> col1 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> col2
               <span class="token keyword">FROM</span> mytable2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面的语句可以检索出客户的订单数量，子查询语句会对第一个查询检索出的每个客户执行一次：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
                   <span class="token keyword">FROM</span> Orders
                   <span class="token keyword">WHERE</span> Orders<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> Customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span>
                   <span class="token keyword">AS</span> orders_num
<span class="token keyword">FROM</span> Customers
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cust_name<span class="token punctuation">;</span>
</code></pre></div><h2 id="连接"><a href="#连接" aria-hidden="true" class="header-anchor">#</a> 连接</h2> <p>连接用于连接多个表，使用 <code>JOIN</code> 关键字，并且条件语句使用 <code>ON</code> 而不是 <code>WHERE。</code></p> <p>连接可以替换子查询，并且比子查询的效率一般会更快。</p> <p>可以用 <code>AS</code> 给列名、计算字段和表名取别名，给表名取别名是为了简化 <code>SQL</code> 语句以及连接相同表。</p> <ul><li><p><strong>内连接</strong></p> <p>内连接又称等值连接，使用 <code>INNER JOIN</code> 关键字。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> B<span class="token punctuation">.</span><span class="token keyword">value</span>
<span class="token keyword">FROM</span> tablea <span class="token keyword">AS</span> A <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tableb <span class="token keyword">AS</span> B
<span class="token keyword">ON</span> A<span class="token punctuation">.</span><span class="token keyword">key</span> <span class="token operator">=</span> B<span class="token punctuation">.</span><span class="token keyword">key</span><span class="token punctuation">;</span>
</code></pre></div><p>可以不明确使用 <code>INNER JOIN</code>，而使用普通查询并在 <code>WHERE</code> 中将两个表中要连接的列用等值方法连接起来。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> B<span class="token punctuation">.</span><span class="token keyword">value</span>
<span class="token keyword">FROM</span> tablea <span class="token keyword">AS</span> A<span class="token punctuation">,</span> tableb <span class="token keyword">AS</span> B
<span class="token keyword">WHERE</span> A<span class="token punctuation">.</span><span class="token keyword">key</span> <span class="token operator">=</span> B<span class="token punctuation">.</span><span class="token keyword">key</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><strong>自连接</strong></p> <p>自连接可以看成内连接的一种，只是连接的表是自身而已。</p> <p>一张员工表，包含员工姓名和员工所属部门，要找出与 Jim 处在同一部门的所有员工姓名。</p> <ul><li>子查询版本<div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name
<span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> department <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> department
    <span class="token keyword">FROM</span> employee
    <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&quot;Jim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>自连接版本<div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e1<span class="token punctuation">.</span>name
<span class="token keyword">FROM</span> employee <span class="token keyword">AS</span> e1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employee <span class="token keyword">AS</span> e2
<span class="token keyword">ON</span> e1<span class="token punctuation">.</span>department <span class="token operator">=</span> e2<span class="token punctuation">.</span>department
    <span class="token operator">AND</span> e2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Jim&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p><strong>自然连接</strong></p> <p>自然连接是把同名列通过等值测试连接起来的，同名列可以有多个。</p> <p>内连接和自然连接的区别：内连接提供连接的列，而自然连接自动连接所有同名列。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> B<span class="token punctuation">.</span><span class="token keyword">value</span>
<span class="token keyword">FROM</span> tablea <span class="token keyword">AS</span> A <span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span> tableb <span class="token keyword">AS</span> B<span class="token punctuation">;</span>
</code></pre></div></li> <li><p><strong>外连接</strong></p> <p>外连接保留了没有关联的那些行。分为左外连接，右外连接以及全外连接，左外连接就是保留左表没有关联的行。</p> <p>检索所有顾客的订单信息，包括还没有订单信息的顾客。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> Orders<span class="token punctuation">.</span>order_num
<span class="token keyword">FROM</span> Customers <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> Orders
<span class="token keyword">ON</span> Customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> Orders<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="组合查询"><a href="#组合查询" aria-hidden="true" class="header-anchor">#</a> 组合查询</h2> <p>使用 <code>UNION</code> 来组合两个查询，如果第一个查询返回 <code>M</code> 行，第二个查询返回 <code>N</code> 行，那么组合查询的结果一般为 <code>M+N</code> 行。</p> <p>每个查询必须包含相同的列、表达式和聚集函数。</p> <p>默认会去除相同行，如果需要保留相同行，使用 <code>UNION ALL</code>。</p> <p>只能包含一个 <code>ORDER BY</code> 子句，并且必须位于语句的最后。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> col
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> col
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="视图"><a href="#视图" aria-hidden="true" class="header-anchor">#</a> 视图</h2> <p>视图是虚拟的表，本身不包含数据，也就不能对其进行索引操作。</p> <p>对视图的操作和对普通表的操作一样。</p> <p>视图具有如下好处：</p> <ul><li>简化复杂的 <code>SQL</code> 操作，比如复杂的连接</li> <li>只使用实际表的一部分数据；</li> <li>通过只给用户访问视图的权限，保证数据的安全性；</li> <li>更改数据格式和表示。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> myview <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span> <span class="token keyword">AS</span> concat_col<span class="token punctuation">,</span> col3<span class="token operator">*</span>col4 <span class="token keyword">AS</span> compute_col
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> col5 <span class="token operator">=</span> val<span class="token punctuation">;</span>
</code></pre></div><h2 id="存储过程"><a href="#存储过程" aria-hidden="true" class="header-anchor">#</a> 存储过程</h2> <p>存储过程可以看成是对一系列 <code>SQL</code> 操作的批处理。</p> <p>使用存储过程的好处：</p> <ul><li>代码封装，保证了一定的安全性；</li> <li>代码复用；</li> <li>由于是预先编译，因此具有很高的性能。</li></ul> <p>命令行中创建存储过程需要自定义分隔符，因为命令行是以 <code>;</code> 为结束符，而存储过程中也包含了分号，因此会错误把这部分分号当成是结束符，造成语法错误。</p> <p>包含 <code>in</code>、<code>out</code> 和 <code>inout</code> 三种参数。</p> <p>给变量赋值都需要用 <code>select into</code> 语句。</p> <p>每次只能给一个变量赋值，不支持集合的操作。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token comment">//</span>

<span class="token keyword">create</span> <span class="token keyword">procedure</span> myprocedure<span class="token punctuation">(</span> <span class="token keyword">out</span> ret <span class="token keyword">int</span> <span class="token punctuation">)</span>
    <span class="token keyword">begin</span>
        <span class="token keyword">declare</span> y <span class="token keyword">int</span><span class="token punctuation">;</span>
        <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>col1<span class="token punctuation">)</span>
        <span class="token keyword">from</span> mytable
        <span class="token keyword">into</span> y<span class="token punctuation">;</span>
        <span class="token keyword">select</span> y<span class="token operator">*</span>y <span class="token keyword">into</span> ret<span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token comment">//</span>

<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">call</span> myprocedure<span class="token punctuation">(</span><span class="token variable">@ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token variable">@ret</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Hewie8023/HewieBlog/edit/master/docs/database/db4.md" target="_blank" rel="noopener noreferrer">编辑文档~</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019-10-30 22:24:29</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/db3.html" class="prev">隔离级别</a></span> <span class="next"><a href="/database/db5.html">MySQL</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div></div></div></div>
    <script src="/assets/js/app.ac521fa5.js" defer></script><script src="/assets/js/2.4dd89565.js" defer></script><script src="/assets/js/41.574827e9.js" defer></script><script src="/assets/js/3.ee0ff96a.js" defer></script>
  </body>
</html>
